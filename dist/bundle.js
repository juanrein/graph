(()=>{"use strict";var t;!function(t){t.DELETE="delete",t.ADD="add"}(t||(t={}));var e=function(){function e(t){this.defaults=t,this.values=Object.assign({},t)}return e.prototype.handleInputValueChange=function(e){var n=e.id,i=e.value;switch(n){case"edgeValue":this.values.edgeValue=i;break;case"nodeValue":this.values.nodeValue=i;break;case"radius":var o=parseFloat(i);!isNaN(o)&&o>0&&(this.values.radius=o);break;case"delete":this.values.mode=t.DELETE;break;case"add":this.values.mode=t.ADD;break;default:console.error(n,i)}},e}(),n=function(){function e(t,e,n){this.view=e,this.graph=t,this.valueController=n}return e.prototype.handleMouseDown=function(t){var e=t.offsetX,n=t.offsetY;this.mouseDownPoint={x:e,y:n}},e.prototype.handleMouseUp=function(e){var n=e.offsetX,i=e.offsetY,o={point:{x:n,y:i},radius:this.valueController.values.radius},r=this.graph.find(this.mouseDownPoint),s=this.graph.find(o.point);if(r||s)if(r&&s)if(r.equals(s))this.valueController.values.mode===t.DELETE&&this.graph.delete(r);else{var a=this.valueController.values.edgeValue;this.graph.connect(r,s,a)}else r&&!s&&(r.circle.point.x=n,r.circle.point.y=i);else"<autoincrement>"===this.valueController.values.nodeValue?this.graph.addNode(o,null):this.graph.addNode(o,this.valueController.values.nodeValue);this.view.update()},e}(),i=function(){function t(t){this.graph=t}return t.prototype.handleExport=function(t){var e=JSON.stringify(this.graph,null,4);navigator.clipboard.writeText(e)},t}();function o(t){return{x:(t.x1+t.x2)/2,y:(t.y1+t.y2)/2}}function r(t,e){var n=t.point,i=n.x,o=n.y,r=t.radius,s=e.x,a=e.y;return(s-i)*(s-i)+(a-o)*(a-o)<=r*r}function s(t,e){var n=t.radius,i=t.point,o=i.x,r=i.y,s=e.radius,a=e.point,c=a.x,u=a.y;return Math.sqrt((o-c)*(o-c)+(r-u)*(r-u))<=n+s}var a=function(){function t(e,n){this.circle=e,this.id=t.identifier,t.identifier++,this.value=null==n?this.id.toString():n}return t.prototype.equals=function(t){return this.id==t.id},t.identifier=0,t}(),c=function(){function t(t){this.nodes=[],this.connections=[],this.directed=t}return t.prototype.addNode=function(t,e){var n=new a(t,e);return this.nodes.push(n),this.connections.push([]),n},t.prototype.find=function(t){if(t)for(var e=0,n=this.nodes;e<n.length;e++){var i=n[e];if(r(i.circle,t))return i}},t.prototype.intersectsAny=function(t){for(var e=0,n=this.nodes;e<n.length;e++)if(s(n[e].circle,t))return!0;return!1},t.prototype.connect=function(t,e,n){var i=this.nodes.findIndex((function(e){return t.equals(e)})),o=this.nodes.findIndex((function(t){return e.equals(t)}));if(-1==i||-1==o)throw new Error("Both nodes don't exist "+t+" "+e);this.connections[i].find((function(t){return t.to===o}))||(this.connections[i].push({to:o,value:n}),this.directed||this.connections[o].find((function(t){return t.to===i}))||this.connections[o].push({to:i,value:n}))},t.prototype.getConnectionsAsLines=function(){for(var t,e,n,i,r,s,a,c,u,h,d,l,f,p,v=[],x=0;x<this.connections.length;x++)for(var g=this.nodes[x].circle,y=0;y<this.connections[x].length;y++){var w=this.nodes[this.connections[x][y].to],E=this.connections[x][y].value,m=(t=g,e=w.circle,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,n=t.point.x,i=t.point.y,r=e.point.x,s=e.point.y,a=t.radius,c=e.radius,h=s-i,d=n-r,l=i-s,{x1:n+(u=r-n)/(f=Math.sqrt(u*u+h*h))*a,y1:i+h/f*a,x2:r+d/(p=Math.sqrt(d*d+l*l))*c,y2:s+l/p*c}),b={point:o(m),text:E};v.push({line:m,text:b})}return v},t.prototype.delete=function(t){var e=this.nodes.findIndex((function(e){return e.equals(t)}));if(-1===e)throw new Error("Node doesn't exist "+t);this.nodes.splice(e,1),this.connections.splice(e,1);for(var n=0;n<this.connections.length;n++){var i=this.connections[n].findIndex((function(t){return t.to===e}));-1!==i&&this.connections[n].splice(i,1);for(var o=0;o<this.connections[n].length;o++)this.connections[n][o].to>e&&this.connections[n][o].to--}},t}(),u=function(){function t(t,e,n){this.canvas=t,this.ctx=e,this.ctx.lineWidth=2,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.graph=n,this.update()}return t.prototype.update=function(){var t=this;this.ctx.fillStyle="rgb(33, 32, 36)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.graph.nodes.forEach((function(e){return t.drawNode(e)})),this.graph.getConnectionsAsLines().forEach((function(e){t.drawLine(e.line),t.drawText(e.text)}))},t.prototype.drawText=function(t){var e=t.text,n=t.point,i=n.x,o=n.y;this.ctx.font="20px Arial",this.ctx.fillStyle="rgb(239, 237, 247)",this.ctx.fillText(e,i+10,o+10)},t.prototype.drawNode=function(t){var e=t.circle,n=t.value;this.ctx.font="30px Arial",this.ctx.fillStyle="rgb(239, 237, 245)",this.ctx.strokeStyle="rgb(239, 237, 247)";var i=e.point,o=i.x,r=i.y,s=e.radius;this.ctx.beginPath(),this.ctx.arc(o,r,s,0,2*Math.PI),this.ctx.stroke(),this.ctx.fillText(n,o,r)},t.prototype.drawLine=function(t){var e=t.x1,n=t.y1,i=t.x2,o=t.y2;this.ctx.beginPath(),this.ctx.moveTo(e,n),this.ctx.lineTo(i,o),this.ctx.stroke()},t}();window.onload=function(){var o={radius:50,nodeValue:"<autoincrement>",edgeValue:"",mode:t.ADD},r=document.getElementById("canvas"),s=document.getElementById("controls").offsetHeight;r.height=Math.floor(window.innerHeight-s),r.width=Math.floor(window.innerWidth);var a=r.getContext("2d"),h=document.getElementById("exportButton"),d=new c(!1),l=new u(r,a,d),f=new e(o),p=new i(d),v=new n(d,l,f);h.addEventListener("click",(function(t){return p.handleExport(t)})),r.addEventListener("mousedown",(function(t){return v.handleMouseDown(t)})),r.addEventListener("mouseup",(function(t){return v.handleMouseUp(t)})),document.querySelectorAll("input").forEach((function(t,e,n){t.addEventListener("change",(function(e){f.handleInputValueChange(t)}))}))}})();