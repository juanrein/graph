(()=>{"use strict";var t;!function(t){t.DELETE="delete",t.ADD="add"}(t||(t={}));var n=function(){function n(t){this.defaults=t,this.values=Object.assign({},t)}return n.prototype.handleInputValueChange=function(n){var e=n.id,i=n.value,o=n.type;if("number"===o){var r=parseInt(i);isNaN(r)||(this.values[e]=r)}else"radio"===o?this.values.mode="add"===i?t.ADD:t.DELETE:this.values[e]=i},n}(),e=function(){function n(t,n,e){this.view=n,this.graph=t,this.valueController=e}return n.prototype.handleMouseDown=function(t){var n=t.offsetX,e=t.offsetY;this.mouseDownPoint={x:n,y:e}},n.prototype.handleMouseUp=function(n){var e=n.offsetX,i=n.offsetY,o={point:{x:e,y:i},radius:this.valueController.values.radius},r=this.graph.find(this.mouseDownPoint),s=this.graph.find(o.point);r||s?r&&s?r.equals(s)?this.valueController.values.mode===t.DELETE&&this.graph.delete(r):this.graph.connect(r,s):r&&!s&&(r.circle.point.x=e,r.circle.point.y=i):"<autoincrement>"===this.valueController.values.nodeValue?this.graph.addNode(o,null):this.graph.addNode(o,this.valueController.values.nodeValue),this.view.update()},n}(),i=function(){function t(t){this.graph=t}return t.prototype.handleExport=function(t){var n=JSON.stringify(this.graph,null,4);navigator.clipboard.writeText(n)},t}();function o(t,n){var e=t.point,i=e.x,o=e.y,r=t.radius,s=n.x,c=n.y;return(s-i)*(s-i)+(c-o)*(c-o)<=r*r}function r(t,n){var e=t.radius,i=t.point,o=i.x,r=i.y,s=n.radius,c=n.point,a=c.x,u=c.y;return Math.sqrt((o-a)*(o-a)+(r-u)*(r-u))<=e+s}var s=function(){function t(n,e){this.circle=n,this.id=t.identifier,t.identifier++,this.value=null==e?this.id.toString():e}return t.prototype.equals=function(t){return this.id==t.id},t.identifier=0,t}(),c=function(){function t(t){this.nodes=[],this.connections=[],this.directed=t}return t.prototype.addNode=function(t,n){var e=new s(t,n);return this.nodes.push(e),this.connections.push([]),e},t.prototype.find=function(t){if(t)for(var n=0,e=this.nodes;n<e.length;n++){var i=e[n];if(o(i.circle,t))return i}},t.prototype.intersectsAny=function(t){for(var n=0,e=this.nodes;n<e.length;n++)if(r(e[n].circle,t))return!0;return!1},t.prototype.connect=function(t,n){var e=this.nodes.findIndex((function(n){return t.equals(n)})),i=this.nodes.findIndex((function(t){return n.equals(t)}));if(-1==e||-1==i)throw new Error("Both nodes don't exist "+t+" "+n);this.connections[e].includes(i)||(this.connections[e].push(i),this.directed||this.connections[i].includes(e)||this.connections[i].push(e))},t.prototype.getConnectionsAsLines=function(){for(var t,n,e,i,o,r,s,c,a,u,h,d,l,f,p=[],v=0;v<this.connections.length;v++)for(var x=this.nodes[v].circle,g=0;g<this.connections[v].length;g++){var y=(t=x,n=this.nodes[this.connections[v][g]].circle,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e=t.point.x,i=t.point.y,o=n.point.x,r=n.point.y,s=t.radius,c=n.radius,u=r-i,h=e-o,d=i-r,{x1:e+(a=o-e)/(l=Math.sqrt(a*a+u*u))*s,y1:i+u/l*s,x2:o+h/(f=Math.sqrt(h*h+d*d))*c,y2:r+d/f*c});p.push(y)}return p},t.prototype.delete=function(t){var n=this.nodes.findIndex((function(n){return n.equals(t)}));if(-1===n)throw new Error("Node doesn't exist "+t);this.nodes.splice(n,1),this.connections.splice(n,1);for(var e=0;e<this.connections.length;e++){var i=this.connections[e].findIndex((function(t){return t===n}));-1!==i&&this.connections[e].splice(i,1);for(var o=0;o<this.connections[e].length;o++)this.connections[e][o]>n&&this.connections[e][o]--}},t}(),a=function(){function t(t,n,e){this.canvas=t,this.ctx=n,this.graph=e}return t.prototype.update=function(){var t=this;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.graph.nodes.forEach((function(n){return t.drawNode(n)})),this.graph.getConnectionsAsLines().forEach((function(n){return t.drawLine(n)}))},t.prototype.drawNode=function(t){var n=t.circle,e=t.value,i=n.point,o=i.x,r=i.y,s=n.radius;this.ctx.beginPath(),this.ctx.arc(o,r,s,0,2*Math.PI),this.ctx.stroke(),this.ctx.fillText(e,o,r)},t.prototype.drawLine=function(t){var n=t.x1,e=t.y1,i=t.x2,o=t.y2;this.ctx.beginPath(),this.ctx.moveTo(n,e),this.ctx.lineTo(i,o),this.ctx.stroke()},t}();window.onload=function(){var o={radius:50,nodeValue:"<autoincrement>",mode:t.ADD},r=document.getElementById("canvas"),s=document.getElementById("controls").offsetHeight;r.height=Math.floor(window.innerHeight-s),r.width=Math.floor(window.innerWidth);var u=r.getContext("2d");u.font="30px Arial",u.textAlign="center",u.textBaseline="middle";var h=document.getElementById("exportButton"),d=new c(!1),l=new a(r,u,d),f=new n(o),p=new i(d),v=new e(d,l,f);h.addEventListener("click",(function(t){return p.handleExport(t)})),r.addEventListener("mousedown",(function(t){return v.handleMouseDown(t)})),r.addEventListener("mouseup",(function(t){return v.handleMouseUp(t)})),document.querySelectorAll("input").forEach((function(t,n,e){t.addEventListener("change",(function(n){f.handleInputValueChange(t)}))}))}})();